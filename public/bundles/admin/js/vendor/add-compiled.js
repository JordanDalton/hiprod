var globals={vendorsToImport:{},responseRecords:{},containers:{results:$("#resultsContainer")},forms:{search:$("#search")}};$(".searchInput").focus();$(window).bind("beforeunload",function(){if(1<=Object.keys(window.globals.vendorsToImport).length)if(/Firefox[\/\s](\d+)/.test(navigator.userAgent)&&4<=new Number(RegExp.$1))confirm("Are you sure do you want to leave? You have not imported the items you've selected.")?history.go():window.setTimeout(function(){window.stop()},1);else return"Are you sure do you want to leave? You have not imported the items you've selected."});
$("html").delegate(".vendorImports","change",function(){$(".selectedCount").closest("button").fadeTo(100,0.5).delay(100).fadeTo(100,1);var a=$(this).is(":checked"),b=parseInt($(this).attr("asi_number"));a?void 0===globals.vendorsToImport[b]&&(globals.vendorsToImport[b]=b):void 0!==globals.vendorsToImport[b]&&delete globals.vendorsToImport[b]});
$(window).delegate(globals.vendorsToImport,"change",function(){$(".selectedCount").html(Object.keys(window.globals.vendorsToImport).length);$("#previewTable").find("tbody tr").remove();if(1<=Object.keys(window.globals.vendorsToImport).length){var a="";for(key in window.globals.vendorsToImport)a+="<tr><td><p><strong>"+window.globals.responseRecords[key].name+"</strong><br/>AsiNumber: "+window.globals.responseRecords[key].number+'</strong><br/></p></td><td><button asi_number="'+window.globals.responseRecords[key].number+
'" class="removeRecord btn btn-danger">Remove Record</button></td></tr>';$("#previewTable").find("tbody").append(a)}});$("html").delegate(".removeRecord","click",function(a){a.preventDefault();a=parseInt($(this).attr("asi_number"));$('.vendorImports[asi_number="'+a+'"]').click();delete window.globals.vendorsToImport[a];$.grep(window.globals.vendorsToImport);$(window).change()});
$("html").delegate(globals.forms.search,"submit",function(a){a.preventDefault();var b=globals.containers.results,d="",a={q:"asi:"+$.trim($(this).find(".searchInput").val()),rpp:40},e=$("#loadingIndicator");e.show();$.getJSON(asiURL+"supplier/search",a,function(a){b.find("table").find("tbody").find("tr").remove();for(var a=a.Results,c=0;c<=a.length-1;c++)globals.responseRecords[a[c].AsiNumber]={id:a[c].Id,name:a[c].Name,number:a[c].AsiNumber},d+='<tr><td><input asi_number="'+a[c].AsiNumber+'" class="vendorImports" name="vendorImports[]" type="checkbox"/></td><td><p><strong>'+
a[c].Name+"</strong><br/>AsiNumber: "+a[c].AsiNumber+"</strong><br/></p></td></tr>";b.find("table").find("tbody").append(d);e.hide()})});
$("html").delegate(".importSelected","click",function(a){a.preventDefault();a={};for(key in window.globals.vendorsToImport)a[key]=globals.responseRecords[key];var b=$("#importingIndicator"),d=$("#importAlert");$("html").animate({scrollTop:0});b.show();d.hide();$.post(adminAjaxUrl+"import-vendors",{data:a},function(a){parseInt(a);for(key in window.globals.vendorsToImport)delete window.globals.vendorsToImport[key],$(window).change(),globals.forms.search.find(".searchInput").val(),$(".vendorImports[asi_number="+
key+"]").click();b.hide();d.show()},"json")});
