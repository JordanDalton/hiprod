var globals={productsToImport:{},responseRecords:{},containers:{results:$("#resultsContainer")},forms:{search:$("#search")},tables:{ajaxResultsTable:$("#ajaxResultsTable")}};function timestamp(){return Math.round((new Date).getTime()/1E3)}$(".searchInput").focus();
$(window).bind("beforeunload",function(){if(1<=Object.keys(window.globals.productsToImport).length)if(/Firefox[\/\s](\d+)/.test(navigator.userAgent)&&4<=new Number(RegExp.$1))confirm("Are you sure do you want to leave? You have not imported the items you've selected.")?history.go():window.setTimeout(function(){window.stop()},1);else return"Are you sure do you want to leave? You have not imported the items you've selected."});
$(window).delegate(globals.productsToImport,"change",function(){$(".selectedCount").html(Object.keys(window.globals.productsToImport).length);$("#previewTable").find("tbody tr").remove();if(1<=Object.keys(window.globals.productsToImport).length){var a="";for(key in window.globals.productsToImport)a+='<tr><td><div style="background-image:url('+window.globals.responseRecords[key].image+')" class="productThumbnail"></div><p><strong>'+window.globals.responseRecords[key].name+"</strong></p><p>"+window.globals.responseRecords[key].description+
'</p></td><td><button product_number="'+window.globals.responseRecords[key].id+'" class="removeRecord btn btn-danger">Remove Record</button></td></tr>';$("#previewTable").find("tbody").append(a)}});
$("html").delegate(globals.forms.search,"submit",function(a){a.preventDefault();var a=$.trim($(this).find(".searchInput").val()),b=$.trim($(this).find(".page").val()),c=$(this).find(".selectAsiNumber").val();1<=a.length&&(a+=" ");var a={q:a+"asi:"+c,page:b,rpp:40},d=$("#loadingIndicator");d.show();$("#resultsContainer").load(adminAjaxUrl+"asi-product-search",a,function(){$("html").animate({scrollTop:360});for(key in globals.productsToImport)$(".productImports[product_number="+key+"]").attr("checked",
"checked");d.hide()})});
$("html").delegate(".productImports","change",function(){$(".selectedCount").closest("li").fadeTo(100,0.5).delay(100).fadeTo(100,1);var a=$(this).is(":checked"),b=parseInt($(this).attr("product_number"));a?void 0===globals.productsToImport[b]&&(globals.productsToImport[b]=b,$("#ajaxResultsTable"),globals.tables.ajaxResultsTable=$("#ajaxResultsTable"),globals.responseRecords[b]={id:b,image:globals.tables.ajaxResultsTable.find("tr[product_number="+b+"]").find(".recordImage").text(),name:globals.tables.ajaxResultsTable.find("tr[product_number="+
b+"]").find(".recordName").text(),description:globals.tables.ajaxResultsTable.find("tr[product_number="+b+"]").find(".recordDescription").text(),supplier_id:globals.tables.ajaxResultsTable.find("tr[product_number="+b+"]").find(".recordSupplierId").text()}):void 0!==globals.productsToImport[b]&&(delete globals.productsToImport[b],delete globals.responseRecords[b])});
$("html").delegate(".prevPage","click",function(a){a.preventDefault();var a=globals.forms.search,b=parseInt(a.find(".page").val())-1;a.find(".page").val(b);a.submit()});$("html").delegate(".nextPage","click",function(a){a.preventDefault();var a=globals.forms.search,b=parseInt(a.find(".page").val())+1;a.find(".page").val(b);a.submit()});
$("html").delegate(".removeRecord","click",function(a){a.preventDefault();a=parseInt($(this).attr("product_number"));$('.productImports[product_number="'+a+'"]').click();delete window.globals.productsToImport[a];$.grep(window.globals.productsToImport);$(window).change()});
$("html").delegate(".importSelected","click",function(a){a.preventDefault();a={};for(key in window.globals.productsToImport)a[key]=globals.responseRecords[key];var b=$("#importingIndicator"),c=$("#importAlert");$("html").animate({scrollTop:0});b.show();c.hide();$.post(adminAjaxUrl+"import-products",{data:a},function(a){parseInt(a);for(key in window.globals.productsToImport)delete window.globals.productsToImport[key],$(window).change(),globals.forms.search.find(".searchInput").val(""),$(".productImports[product_number="+
key+"]").click();b.hide();c.show()},"json")});
